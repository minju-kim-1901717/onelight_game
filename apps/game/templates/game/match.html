<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Îß§Ïπ≠ ÌôïÏù∏</title>

  <style>
    body{
      font-family:system-ui;
      margin:0;
      padding:24px;
      background:radial-gradient(1200px 600px at 50% -10%, #1a0f1f, #0b0b0f 60%);
      color:#fff;
      height:100vh;
    }

    .wrap{
      max-width:560px;
      margin:0 auto;
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));
      border-radius:20px;
      padding:18px;
      border:1px solid rgba(255,255,255,.08);
      box-shadow:
        0 22px 60px rgba(0,0,0,.6),
        0 0 44px rgba(199,20,199,.12);
    }

    .title{
      font-weight:900;
      font-size:20px;
      text-align:center;
      margin-bottom:6px;

      background: linear-gradient(
        120deg,
        #c714c7 0%,
        #ff6ad5 35%,
        #ffffff 50%,
        #ff6ad5 65%,
        #c714c7 100%
      );
      background-size: 300% 300%;
      animation: gradientMove 6s ease infinite;

      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;

      text-shadow:
        0 0 18px rgba(199,20,199,.35),
        0 0 36px rgba(199,20,199,.18);
    }


    .muted{
      opacity:.78;
      font-size:13px;
      text-align:center;
    }

    .matchList{
      display:flex;
      flex-direction:column;
      gap:12px;
      margin-top:14px;
    }

    .matchItem{
      background:#141420;
      border-radius:16px;
      padding:16px;
      font-weight:900;
      font-size:18px;
      text-align:center;
      border:1px solid rgba(255,255,255,.06);
      box-shadow: 0 12px 30px rgba(0,0,0,.45);
      animation: popIn .35s ease forwards;
      user-select:none;
    }

    .matchItem span{
      background: linear-gradient(135deg, #ff6ad5, #ffffff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    @keyframes popIn{
      from{opacity:0; transform: translateY(10px) scale(.96);}
      to{opacity:1; transform: translateY(0) scale(1);}
    }

    .empty{
      margin-top:18px;
      text-align:center;
      opacity:.75;
      font-size:14px;
    }

    .nav{display:flex;gap:10px;margin-top:6px}
    .nav button{
      flex:1;padding:14px;border-radius:14px;border:0;font-weight:900;
      cursor:pointer;background:#2a2a3a;color:#fff;
      transition:transform .15s ease, filter .15s ease;
    }
    .nav button:hover{ transform:translateY(-1px); filter:brightness(1.08); }

    /* ====== FULLSCREEN MATCH FX ====== */
    .fx{
      position:fixed; inset:0;
      display:none;
      align-items:center;
      justify-content:center;
      padding:24px;
      background: rgba(0,0,0,.72);
      backdrop-filter: blur(6px);
      z-index:9999;
      overflow:hidden;
    }
    .fx.show{ display:flex; }

    .fxPanel{
      width:min(520px, 92vw);
      border-radius:22px;
      padding:20px 18px;
      text-align:center;
      border:1px solid rgba(255,255,255,.10);
      background: radial-gradient(900px 320px at 50% 0%, rgba(199,20,199,.20), rgba(20,20,32,.9) 60%);
      box-shadow:
        0 30px 90px rgba(0,0,0,.7),
        0 0 70px rgba(199,20,199,.22);
      transform: translateY(14px) scale(.96);
      opacity:0;
      animation: fxIn .28s ease forwards;
    }
    @keyframes fxIn{
      to{ transform: translateY(0) scale(1); opacity:1; }
    }

    .fxTitle{
      font-weight:1000;
      font-size:26px;
      letter-spacing:-0.3px;
      margin:0;

      background: linear-gradient(
        120deg,
        #c714c7,
        #ff6ad5,
        #ffffff,
        #ff6ad5,
        #c714c7
      );
      background-size: 400% 400%;
      animation: gradientMove 4.5s ease infinite;

      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;

      text-shadow:
        0 0 22px rgba(199,20,199,.5),
        0 0 40px rgba(199,20,199,.25);
    }


    .fxSub{
      margin-top:8px;
      opacity:.82;
      font-weight:900;
    }
    .fxName{
      margin-top:14px;
      font-weight:1000;
      font-size:22px;
      background: linear-gradient(135deg, #ff6ad5, #ffffff);
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      text-shadow: 0 0 18px rgba(255,106,213,.25);
    }
    .fxBtn{
      margin-top:16px;
      width:100%;
      padding:14px;
      border-radius:14px;
      border:0;
      font-weight:1000;
      background:#c714c7;
      color:#fff;
      cursor:pointer;
      box-shadow: 0 12px 30px rgba(199,20,199,.25);
    }

    /* confetti */
    .confetti{
      position:absolute;
      top:-10px;
      width:10px;
      height:14px;
      opacity:.9;
      border-radius:3px;
      animation: fall 1.6s linear forwards;
      filter: drop-shadow(0 0 10px rgba(199,20,199,.18));
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(540deg); opacity:0.2; }
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <div class="title">MATCHED ‚ú®</div>
    <div id="state" class="muted">Î∂àÎü¨Ïò§Îäî Ï§ë...</div>

    <div id="list" class="matchList"></div>
    <div id="empty" class="empty" style="display:none;">‚ÄúÌïòÎ£®Ïóê ÌïòÎÇò, Îî± ÌïúÎ≤àÎßå ÏºúÏßÄÎäî ÏûêÎ¶¨‚Äù</div>
  </div>

  <div class="nav">
    <button onclick="location.href='/lobby/'">Î°úÎπÑ</button>
    <button onclick="location.href='/play/'">Ìò∏Í∞ê Î≥¥ÎÇ¥Í∏∞</button>
  </div>
</div>

<!-- Fullscreen FX -->
<div id="fx" class="fx" onclick="closeFxIfBackdrop(event)">
  <div class="fxPanel">
    <h1 class="fxTitle">IT'S A MATCH</h1>
    <div class="fxSub">Ïò§ÎäòÏùò Ïó∞Í≤∞Ïù¥ ÎßåÎì§Ïñ¥Ï°åÏñ¥Ïöî</div>
    <div id="fxName" class="fxName"></div>
    <button class="fxBtn" onclick="closeFx()">ÌôïÏù∏</button>
  </div>
</div>

<script>
function closeFxIfBackdrop(e){
  if(e.target.id === "fx") closeFx();
}
function closeFx(){
  document.getElementById("fx").classList.remove("show");
}

function burstConfetti(){
  const fx = document.getElementById("fx");
  const colors = ["#c714c7","#ff6ad5","#ffffff","#8a2be2","#ff4fd8"];
  for(let i=0;i<46;i++){
    const el = document.createElement("div");
    el.className = "confetti";
    el.style.left = Math.random()*100 + "vw";
    el.style.background = colors[Math.floor(Math.random()*colors.length)];
    el.style.transform = `translateY(0) rotate(${Math.random()*180}deg)`;
    el.style.animationDuration = (1.2 + Math.random()*0.9) + "s";
    el.style.width = (6 + Math.random()*10) + "px";
    el.style.height = (8 + Math.random()*16) + "px";
    el.style.opacity = (0.55 + Math.random()*0.45);
    fx.appendChild(el);
    setTimeout(()=> el.remove(), 2200);
  }
}

function showFxFor(name){
  document.getElementById("fxName").innerText = `üéâ ${name} ÎãòÍ≥º Îß§Ïπ≠!`;
  const fx = document.getElementById("fx");
  fx.classList.add("show");
  burstConfetti();
}

async function loadMatches(){
  const res = await fetch("/api/matches/");
  if(!res.ok){ location.href="/"; return; }

  const data = await res.json();
  const matches = data.matches || [];

  const state = document.getElementById("state");
  const list = document.getElementById("list");
  const empty = document.getElementById("empty");

  list.innerHTML = "";

  if(matches.length === 0){
    state.innerText = "ÏïÑÏßÅ Îß§Ïπ≠Îêú ÏÉÅÎåÄÍ∞Ä ÏóÜÏñ¥Ïöî.";
    empty.style.display = "block";
  } else {
    state.innerText = `Ï¥ù ${matches.length}Î™ÖÍ≥º Îß§Ïπ≠ÎêêÏñ¥Ïöî`;
    empty.style.display = "none";

    matches.forEach((m, i) => {
      const div = document.createElement("div");
      div.className = "matchItem";
      div.style.animationDelay = `${i * 0.06}s`;
      div.innerHTML = `üéâ <span>${m.nickname}</span> ÎãòÍ≥º Îß§Ïπ≠`;
      list.appendChild(div);
    });
  }

  const key = "onelight_match_count";
  const prev = Number(localStorage.getItem(key) || "0");
  if(matches.length > prev && matches.length > 0){
    const last = matches[matches.length - 1];
    showFxFor(last.nickname);
  }
  localStorage.setItem(key, String(matches.length));
}

loadMatches();
setInterval(loadMatches, 5000); // Ïã§ÏãúÍ∞Ñ ÎäêÎÇå(3Ï¥à Ìè¥ÎßÅ)
</script>
</body>
</html>
